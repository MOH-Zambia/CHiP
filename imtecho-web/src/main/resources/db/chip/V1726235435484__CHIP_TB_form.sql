with insert_into_medplat_form_master as (
	INSERT INTO medplat_form_master
	("uuid", form_name, form_code, current_version, state, created_by, created_on, modified_by, modified_on, menu_config_id)
	SELECT
		'b2cd45b7-d23a-4ad0-beef-924bd561aca1',
		'CHIP_TB',
		'CHIP_TB',
		'1',
		'ACTIVE',
		97104,
		now(),
		97104,
		now(),
		393
	ON CONFLICT (form_code)
	DO UPDATE
	SET
		uuid=EXCLUDED."uuid",
		form_name=EXCLUDED.form_name,
		current_version=cast(cast(coalesce((select max(cast(medplat_form_version_history.version as integer)) from medplat_form_master inner join medplat_form_version_history on medplat_form_master.uuid  = medplat_form_version_history.form_master_uuid where medplat_form_master.form_code = EXCLUDED.form_code and medplat_form_version_history.version <> 'DRAFT'),'0') as integer) + 1 as text),
		state=EXCLUDED.state,
		created_by=EXCLUDED.created_by,
		created_on=EXCLUDED.created_on,
		modified_by=EXCLUDED.modified_by,
		modified_on=EXCLUDED.modified_on,
		menu_config_id=EXCLUDED.menu_config_id
	returning medplat_form_master.current_version
)
INSERT INTO medplat_form_version_history
("uuid", form_master_uuid, template_config, field_config, "version", created_by, created_on, modified_by, modified_on, form_object, template_css, form_vm, execution_sequence, query_config)
SELECT
	'ca8220f4-8305-786b-e86b-1f575c20a068',
	'b2cd45b7-d23a-4ad0-beef-924bd561aca1',
	'[{"type":"CARD","config":{"title":"Basic Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"unique_health_id","fieldName":"Member ID","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"age","fieldName":"Age","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"gender","fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"marital_status","fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"last_method_of_contraception","fieldName":"Last method of contraception used","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_phone_no","fieldName":"Family phone number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_address","fieldName":"Family address","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"birth_cert_number","fieldName":"Birth certificate number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"birth_weight","fieldName":"Birth weight","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"weight","fieldName":"Latest weight","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"member_name","fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"dob","fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"nrc_number","fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"religion","fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp","fieldName":"LMP (Last Menstrual Period) date","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"hiv_status","fieldName":"HIV status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"chronic_disease","fieldName":"Chronic diseases","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"developmental_delay","fieldName":"Developmental delays","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"immunisation_status","fieldName":"Immunization status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]},{"type":"CARD","config":{"title":"TB Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"service_date","fieldName":"Service date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"tuberculosis_symptoms","fieldName":"Symptoms","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"other_tb_symptoms","fieldName":"Other Symptoms","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"started_menstruating","fieldName":"Has person started menstruating?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_referral_done","fieldName":"Is referral required?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"Select Health Infrastructure","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"You will be referred to","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_iec_given","fieldName":"Is IEC (Information, Education and Communication) given","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_tb_suspected","fieldName":"Is TB (Tuberculosis) suspected ?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_tb_testing_done","fieldName":"Is testing done?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"reason_for_not_testing","fieldName":"Reason for not testing","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"tb_test_type","fieldName":"Select test type","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp_date","fieldName":"LMP date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_for","fieldName":"Referral reason","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_reason","fieldName":"Other Referral Reason","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]}]',
	'{"CHIP_TB":{"Age":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"age","hasError":false,"showCard":false,"fieldName":"Age","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Age","errorMsgListKeys":[]},"DOB":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"dob","hasError":false,"showCard":false,"fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"null","displayType":"date","showContent":false,"displayValue":"Date of Birth","errorMsgListKeys":[]},"Gender":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"gender","hasError":false,"showCard":false,"fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Gender","errorMsgListKeys":[]},"LMP date":{"label":"LMP date","events":"null","ngModel":"$formData$.tbData","tooltip":"LMP (Last Menstrual Period) date","fieldKey":"lmp_date","isHidden":"false","fieldName":"LMP date","fieldType":"DATE","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.started_menstruating\",\"queryCode\":null,\"expression\":null},{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$infoData$.memberDetails.is_pregnant\"}]}}","placeholder":"LMP (Last Menstrual Period) date","maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minLmpDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter LMP Date"},"Religion":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"religion","hasError":false,"showCard":false,"fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Religion","errorMsgListKeys":[]},"Symptoms":{"label":"Symptoms","events":"{\"Change\":{\"actions\":[{\"type\":\"FORM_METHOD\",\"value\":\"handleSymptomsChange\",\"continueIfFail\":true}]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Symptoms","fieldKey":"tuberculosis_symptoms","isHidden":"false","fieldName":"Symptoms","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"true","isRequired":"true","requirable":"null","visibility":"null","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"},{\"key\":\"-2\",\"value\":\"None\"}]","listValueField":"tuberculosisSymptoms","requiredMessage":"Please select TB Symptoms","additionalStaticOptionsRequired":"true"},"Member ID":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"unique_health_id","hasError":false,"showCard":true,"fieldName":"Member ID","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member ID","errorMsgListKeys":[]},"HIV status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"hiv_status","hasError":false,"showCard":false,"fieldName":"HIV status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"HIV status","errorMsgListKeys":[]},"NRC Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"nrc_number","hasError":false,"showCard":false,"fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"NRC Number","errorMsgListKeys":[]},"Member Name":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"member_name","hasError":false,"showCard":true,"fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member Name","errorMsgListKeys":[]},"Birth weight":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"birth_weight","fieldName":"Birth weight","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Birth weight (in Kgs)"},"Service date":{"label":"Service date","events":"null","ngModel":"$formData$.tbData","tooltip":"Service date","fieldKey":"service_date","isHidden":"false","fieldName":"Service date","fieldType":"DATE","disability":"null","isDisabled":"true","isRequired":"false","requirable":"null","visibility":"null","placeholder":"Service date","maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minServiceDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter service date"},"Latest weight":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"weight","fieldName":"Latest weight","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Latest weight (in Kgs)"},"Family address":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_address","hasError":false,"showCard":false,"fieldName":"Family address","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family address","errorMsgListKeys":[]},"Marital Status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"marital_status","hasError":false,"showCard":false,"fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Marital Status","errorMsgListKeys":[]},"Other Symptoms":{"label":"Other Symptoms","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Other Symptoms","fieldKey":"other_tb_symptoms","isHidden":"false","fieldName":"Other Symptoms","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$formData$.tbData.tuberculosis_symptoms.includes(''-1'')\"}]}}","placeholder":"Please mention other symptoms","requiredMessage":"Please mention other symptoms"},"Referral reason":{"label":"Referral reason","events":"null","ngModel":"$formData$.tbData","tooltip":"Referral reason","fieldKey":"referral_for","isHidden":"false","fieldName":"Referral reason","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"}]","listValueField":"referalReasonNonRch","requiredMessage":"Please select a referral reason","additionalStaticOptionsRequired":"true"},"Chronic diseases":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"chronic_disease","hasError":false,"showCard":false,"fieldName":"Chronic diseases","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Chronic diseases","errorMsgListKeys":[]},"Is testing done?":{"label":"Is testing done?","events":"null","ngModel":"$formData$.tbData","tooltip":"Is testing done?","fieldKey":"is_tb_testing_done","isHidden":"false","fieldName":"Is testing done?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is testing done?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no"},"Select test type":{"label":"Select test type","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Select test type","fieldKey":"tb_test_type","isHidden":"false","fieldName":"Select test type","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_tb_testing_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":null,"listValueField":"tbTestType","requiredMessage":"Please select atleast 1 test type","additionalStaticOptionsRequired":"false"},"Family phone number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_phone_no","hasError":false,"showCard":false,"fieldName":"Family phone number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family phone number","errorMsgListKeys":[]},"Immunization status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"immunisation_status","fieldName":"Immunization status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Immunisation status"},"Developmental delays":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"developmental_delay","hasError":false,"showCard":false,"fieldName":"Developmental delays","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"boolean","showContent":false,"displayValue":"Developmental delays","errorMsgListKeys":[]},"Is referral required?":{"label":"Is referral required?","events":"{\"Change\":{\"actions\":[{\"type\":\"FORM_METHOD\",\"value\":\"setUserHealthinfra\",\"continueIfFail\":true}]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Is referral required?","fieldKey":"is_referral_done","isHidden":"false","fieldName":"Is referral required?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is referral required?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select yes or no"},"Other Referral Reason":{"label":"Other Referral Reason","events":"null","ngModel":"$formData$.tbData","tooltip":"Other Referral Reason","fieldKey":"referral_reason","isHidden":"false","fieldName":"Other Referral Reason","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$formData$.tbData.referral_for.includes(''-1'')\"},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Other Referral Reason","requiredMessage":"Please enter other referral reason"},"Reason for not testing":{"label":"Reason for not testing","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Reason for not testing","fieldKey":"reason_for_not_testing","hasError":false,"isHidden":"false","showCard":false,"fieldName":"Reason for not testing","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"false\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_tb_testing_done\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Reason for not testing","showContent":false,"requiredMessage":"Please enter reason for not testing","errorMsgListKeys":[]},"You will be referred to":{"events":"null","ngModel":"$formData$.tbData","fieldKey":"referral_place","fieldName":"You will be referred to","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra === $formData$.tbData.referral_place[0]\"},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"You will be referred to"},"Birth certificate number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"birth_cert_number","hasError":false,"showCard":false,"fieldName":"Birth certificate number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Birth certificate number","errorMsgListKeys":[]},"Select Health Infrastructure":{"label":"Health Infrastructure","events":"null","ngModel":"$formData$.tbData","tooltip":"Select Health Infrastructure","fieldKey":"referral_place","isHidden":"false","fieldName":"Select Health Infrastructure","fieldType":"DROPDOWN","disability":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra.health_infrastrucutre_id && $formData$.tbData.referral_place && $utilityData$.userHealthInfra.health_infrastrucutre_id === $formData$.tbData.referral_place\"}]}}","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"variableList","placeholder":"--SELECT--","variableList":"$utilityData$.healthInfraList","staticOptions":null,"requiredMessage":"Please search and select Health Infrastructure","additionalStaticOptionsRequired":"false"},"Has person started menstruating?":{"label":"Has person started menstruating?","events":"null","ngModel":"$formData$.tbData","tooltip":"Has person started menstruating?","fieldKey":"started_menstruating","hasError":false,"isHidden":"false","showCard":false,"fieldName":"Has person started menstruating?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"false","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"50\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"null\",\"value2\":null,\"fieldName\":\"$formData$.tbData.lmp_date\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"staticOptions","placeholder":"Has person started menstruating?","showContent":false,"staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":null,"errorMsgListKeys":[]},"Is TB (Tuberculosis) suspected ?":{"label":"Is TB (Tuberculosis) suspected ?","events":"null","ngModel":"$formData$.tbData","tooltip":"Is TB (Tuberculosis) suspected ?","fieldKey":"is_tb_suspected","isHidden":"false","fieldName":"Is TB (Tuberculosis) suspected ?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is TB (Tuberculosis) suspected ?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no"},"LMP (Last Menstrual Period) date":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"lmp","hasError":false,"showCard":false,"fieldName":"LMP (Last Menstrual Period) date","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.started_menstruating\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"date","showContent":false,"displayValue":"LMP (Last Menstrual Period) date","errorMsgListKeys":[]},"Last method of contraception used":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"last_method_of_contraception","hasError":false,"showCard":false,"fieldName":"Last method of contraception used","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Last method of contraception used","errorMsgListKeys":[]},"Is IEC (Information, Education and Communication) given":{"label":"Is IEC (Information, Education and Communication) given","events":"null","ngModel":"$formData$.tbData","tooltip":"Is IEC given","fieldKey":"is_iec_given","isHidden":"false","fieldName":"Is IEC (Information, Education and Communication) given","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is IEC given","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select if IEC given"}}}',
	current_version,
	97104,
	now(),
	97104,
	now(),
	'[{"title":"$formData$","isArray":false,"nodes":[{"title":"tbData","nodes":[],"indexAlias":null,"$$hashKey":"object:826","path":"$formData$.tbData","backendConfigPath":"$formData$.tbData"}],"path":"$formData$","backendConfigPath":"$formData$","$$hashKey":"object:810"},{"title":"$infoData$","isArray":false,"nodes":[{"title":"memberDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:838","path":"$infoData$.memberDetails","backendConfigPath":"$infoData$.memberDetails"}],"path":"$infoData$","backendConfigPath":"$infoData$","$$hashKey":"object:811"}]',
	'label {
    white-space: normal !important;
    line-height: 1.2 !important;
}',
	'{"formVariables":[{"value":"userHealthInfra","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setUserHealthInfra","setterMethodCode":"(function setUserHealthInfra() {\nconsole.log($utilityData$.userHealthInfra)\n\t/**\n\t* Setter method for $utilityData$.userHealthInfra (NUMBER)\n\t* Please see example below on how to set the value\n\t* $utilityData$.userHealthInfra = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"minLmpDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinLmpDate","setterMethodCode":"(function setMinLmpDate() {\n\n$utilityData$.minLmpDate = $infoData$.memberDetails.is_pregnant ? moment().subtract(9, ''months'') : moment().subtract(35, ''days'');\n\n});"},{"value":"ageInYears","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setAgeInYears","setterMethodCode":"(function setAgeInYears() {\n\n    let ageParts = $infoData$.memberDetails.age.split('' '');\n    let years = 0;\n    if (ageParts.length < 6) {\n        years = 0\n    }\n    else {\n        years = isNaN(parseInt(ageParts[0])) ? 0 : parseInt(ageParts[0]);\n    }\n    $utilityData$.ageInYears = years;\n\t\n});"},{"value":"minServiceDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinServiceDate","setterMethodCode":"(function setMinServiceDate() {\n    $utilityData$.minServiceDate = $formData$.tbData.service_date ? moment($formData$.tbData.service_date) : moment().subtract(9, ''months'');\n});"},{"value":"healthInfraList","type":"ARRAY","bindTo":"$utilityData$","setter":true,"setterMethodName":"setHealthInfraList","setterMethodCode":"(function setHealthInfraList() {\n\n\t/**\n\t* Setter method for $utilityData$.healthInfraList (ARRAY)\n\t* Please see example below on how to set the value\n\t* $utilityData$.healthInfraList = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"isChildImmunisedInOneYear","type":"BOOLEAN","bindTo":"$utilityData$","setter":true,"setterMethodName":"setIsChildImmunisedInOneYear","setterMethodCode":"(function setIsChildImmunisedInOneYear() {\n    const childDetails = $infoData$.memberDetails\n        if (childDetails.immunisation_given != null && childDetails.immunisation_given.length > 0) {\n            const immunisationGiven = childDetails.immunisation_given.split(\",\")\n            const immunisationList = []\n\n            for (let immunisation of immunisationGiven) {\n                immunisationList.push(immunisation.split(\"#\")[0])\n            }\n\n\n            if (immunisationList.length) {\n                if (\n                    immunisationList.includes(\"BCG\")\n                    && immunisationList.includes(\"OPV_1\")\n                    && immunisationList.includes(\"OPV_2\")\n                    && immunisationList.includes(\"OPV_3\")\n                    && (immunisationList.includes(\"PENTA_1\") || immunisationList.includes(\"DPT_1\"))\n                    && (immunisationList.includes(\"PENTA_2\") || immunisationList.includes(\"DPT_2\"))\n                    && (immunisationList.includes(\"PENTA_3\") || immunisationList.includes(\"DPT_3\"))\n                    && (immunisationList.includes(\"MEASLES_RUBELLA_1\") || immunisationList.includes(\"MEASLES_1\"))) {\n                    $utilityData$.isChildImmunisedInOneYear = true;\n                } else {\n                    $utilityData$.isChildImmunisedInOneYear = false;\n                }\n            } else {\n                $utilityData$.isChildImmunisedInOneYear = false;\n            }\n        } else {\n            $utilityData$.isChildImmunisedInOneYear = false;\n        }\n});"},{"value":"isChildImmunisedInTwoYear","type":"BOOLEAN","bindTo":"$utilityData$","setter":true,"setterMethodName":"setIsChildImmunisedInTwoYear","setterMethodCode":"(function setIsChildImmunisedInTwoYear() {\n    const childDetails = $infoData$.memberDetails\n        if (childDetails.immunisation_given != null && childDetails.immunisation_given.length > 0) {\n            const immunisationGiven = childDetails.immunisation_given.split(\",\")\n            const immunisationList = []\n\n            for (let immunisation of immunisationGiven) {\n                immunisationList.push(immunisation.split(\"#\")[0])\n            }\n\n            if (immunisationList.length) {\n                if (\n                    immunisationList.includes(\"BCG\")\n                    && immunisationList.includes(\"VITTAMIN_A_50000\")\n                    && immunisationList.includes(\"VITTAMIN_A_100000\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_1\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_2\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_3\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_4\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_5\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_6\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_7\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_8\")\n                    && immunisationList.includes(\"OPV_0\")\n                    && immunisationList.includes(\"OPV_1\")\n                    && immunisationList.includes(\"OPV_2\")\n                    && immunisationList.includes(\"OPV_3\")\n                    && immunisationList.includes(\"PCV_1\")\n                    && immunisationList.includes(\"PCV_2\")\n                    && immunisationList.includes(\"PCV_3\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_1\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_2\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_3\")\n                    && immunisationList.includes(\"ROTA_VACCINE_1\")\n                    && immunisationList.includes(\"MEASLES_RUBELLA_1\")\n                    && immunisationList.includes(\"MEASLES_RUBELLA_2\")) {\n                    $utilityData$.isChildImmunisedInTwoYear = true;\n                } else {\n                    $utilityData$.isChildImmunisedInTwoYear = false;\n                }\n            } else {\n                $utilityData$.isChildImmunisedInTwoYear = false;\n            }\n        } else {\n            $utilityData$.isChildImmunisedInTwoYear = false;\n        }\n});"}],"formMethods":[{"value":"setSymptoms","code":"(function setSymptoms() {\n\t$formData$.tbData.tuberculosis_symptoms = $formData$.tbData?.tuberculosis_symptoms?.split('','').map(data => {\n       if (![''-1'', ''-2''].includes(data)) {\n           return parseInt(data);\n       } else {\n           return data;\n       }\n    });\n});"},{"value":"setTbTestType","code":"(function setTbTestType() {\n\t$formData$.tbData.tb_test_type = $formData$.tbData.tb_test_type.split('','').map(data => parseInt(data));\n});"},{"value":"setUserHealthinfra","code":"(function setUserHealthInfra() {\n    $formData$.tbData.referral_place = $formData$.tbData.is_referral_done && $utilityData$.userHealthInfra ? $utilityData$.userHealthInfra.health_infrastrucutre_id : null\n});"},{"value":"handleSymptomsChange","code":"(function handleSymptomsChange() {\n    if ($formData$.tbData?.tuberculosis_symptoms?.length > 0\n        && $formData$.tbData?.tuberculosis_symptoms?.includes(''-2'')) {\n        $formData$.tbData.tuberculosis_symptoms = [''-2''];\n    }\n});"},{"value":"setImmunisationStatus","code":"(function setImmunisationStatus() {\n\tconst dobDate = new Date($infoData$.memberDetails.dob);\n    const currentDate = new Date();\n    \n    let age = currentDate.getFullYear() - dobDate.getFullYear();\n    const monthDiff = currentDate.getMonth() - dobDate.getMonth();\n    const dayDiff = currentDate.getDate() - dobDate.getDate();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {\n        age--;\n    }\n\n    if (age < 1) {\n        $infoData$.memberDetails.immunisation_status = ''Not fully immunised''\n    } else if (age >= 1 && age <= 2) {\n        $infoData$.memberDetails.immunisation_status = $utilityData$.isChildImmunisedInOneYear ? ''Fully immunised'' : ''Not fully immunised''\n    } else {\n        $infoData$.memberDetails.immunisation_status = $utilityData$.isChildImmunisedInTwoYear ? ''Fully immunised'' : ''Not fully immunised''\n    }\n});"},{"value":"setDropdownValues","code":"(function setDropdownValues() {\n\tif ($formData$.tbData?.referral_for) {\n        $formData$.tbData.referral_for === -1 && ($formData$.tbData.referral_for = ''-1'');\n\t}\n});"}],"formQueries":[{"value":"Get Member Details","queryCode":"get_member_details","params":"memberId","paramConfig":"{\"memberId\":\"$formData$.tbData.member_id\"}","query":"with hof_det as (\nselect im.mobile_number \nfrom imt_member im\nwhere im.family_id = (select family_id from imt_member where id = #memberId#)\nand im.family_head\n)\nselect \n\tim.id, im.unique_health_id, \n\tim.family_id, concat_ws('' '', im.first_name, im.middle_name, im.last_name) as member_name, \n\tim.dob, \n\t(select value from listvalue_field_value_detail where id = im.marital_status) as marital_status,\n    (select value from listvalue_field_value_detail where cast(id as text) = im.member_religion) as religion,\n\tcast(age(current_date, im.dob) as text) as age,\n\tim.nrc_number, \n\tim.last_method_of_contraception, im.lmp,\n\tcast(im.additional_info as json)->> ''hivTest'' as hiv_status,\n    (select string_agg(value, '', '')  from listvalue_field_value_detail lfvd \n    where cast(id as text) in (select unnest(string_to_array(im.chronic_disease,'','')))) as chronic_disease,\n    im.birth_cert_number,\n    im.mother_name,\n    im.birth_weight,\n    im.weight,\n    im.is_pregnant,\n    im.immunisation_given,\n    cast(im.additional_info as json)->> ''developmentalDelays'' as developmental_delay,\n    cast(im.additional_info as json)->> ''lastServiceLongGate'' as last_service_date,\n    (select mobile_number from hof_det) as family_phone_no,\n\tcase when im.gender = ''F'' then ''Female'' else ''Male'' end as gender,\n\tconcat_ws('' '', if2.house_number, if2.address1, if2.address2) as family_address,\n\tif2.area_id, if2.location_id \nfrom \n\timt_member im \ninner join \n\timt_family if2 on im.family_id = if2.family_id \nwhere \n\tim.id = #memberId#;","response":"$infoData$.memberDetails","isResultArray":null,"successMessage":null,"failureMessage":"Member not found.","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get User Health Infra","queryCode":"get_user_health_infra","params":"userID","paramConfig":"{\"userID\":\"$loggedInUserId$\"}","query":"select health_infrastrucutre_id from user_health_infrastructure where user_id = #userID# and is_default = true;","response":"$utilityData$.userHealthInfra","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":false,"isField":null,"isPagination":false},{"value":"Get Member TB Details","queryCode":"get_mem_tb_det","params":"tb_screening_id","paramConfig":"{\"tb_screening_id\":\"$stateParams$.id\"}","query":"select \n    tsd.id,\n    tsd.member_id,\n    tsd.tuberculosis_symptoms as tuberculosis_symptoms,\n    tsd.other_tb_symptoms,\n    tsd.started_menstruating,\n    tsd.lmp_date,\n    case when tsd.is_referral_done = ''YES'' then true \n    else false end as is_referral_done,\n    cast (tsd.referral_place as text) as referral_place,\n    cast(tsd.referral_for as integer) as referral_for,\n    tsd.referral_reason,\n    tsd.is_iec_given,\n    tsd.is_tb_testing_done,\n    cast(tsd.tb_test_type as integer) tb_test_type,\n    tsd.is_tb_suspected,\n    tsd.is_tb_cured,\n    tsd.reason_for_not_testing\nfrom tuberculosis_screening_details tsd \nwhere tsd.id = #tb_screening_id#\nand form_type = ''TB_SCREENING''\norder by modified_on desc limit 1;","response":"$formData$.tbData","isResultArray":null,"successMessage":null,"failureMessage":"Screening records not found","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get health infra list","queryCode":"get_health_infra_list","params":"","paramConfig":"{}","query":"select  h.name , h.id,h.type as type from health_infrastructure_details h;\n","response":"$utilityData$.healthInfraList","isResultArray":true,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":true,"isPagination":false,"dropdownKey":"id","dropdownValue":"name","toVariable":true}]}',
	'[{"type":"FORM_QUERY","value":"Get Member TB Details","continueIfFail":false},{"type":"FORM_QUERY","value":"Get Member Details","continueIfFail":false},{"type":"FORM_VARIABLE_SETTER","value":"ageInYears","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minServiceDate","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"isChildImmunisedInOneYear","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"isChildImmunisedInTwoYear","continueIfFail":true},{"type":"FORM_METHOD","value":"setDropdownValues","continueIfFail":true},{"type":"FORM_METHOD","value":"setImmunisationStatus","continueIfFail":true},{"type":"FORM_METHOD","value":"setSymptoms","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minLmpDate","continueIfFail":true},{"type":"FORM_QUERY","value":"Get User Health Infra","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"userHealthInfra","continueIfFail":true},{"type":"FORM_QUERY","value":"Get health infra list","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"healthInfraList","continueIfFail":true},{"type":"FORM_METHOD","value":"setUserHealthinfra","continueIfFail":true}]',
	'[{"queryCode":"update_tb_scr_det","hasLoop":null,"queryPath":"$formData$.tbData","subQueries":[],"params":[{"key":"tuberculosis_symptoms","type":"FIELD","valueKey":"tuberculosis_symptoms"},{"key":"is_testing_done","type":"FIELD","valueKey":"is_tb_testing_done"},{"key":"tb_test_type","type":"FIELD","valueKey":"tb_test_type"},{"key":"is_tb_suspected","type":"FIELD","valueKey":"is_tb_suspected"},{"key":"referral_place","type":"FIELD","valueKey":"referral_place"},{"key":"other_symptoms","type":"FIELD","valueKey":"other_tb_symptoms"},{"key":"is_referral_done","type":"FIELD","valueKey":"is_referral_done"},{"key":"referral_for","type":"FIELD","valueKey":"referral_for"},{"key":"referral_reason","type":"FIELD","valueKey":"referral_reason"},{"key":"started_menstruating","type":"FIELD","valueKey":"started_menstruating"},{"key":"lmp_date","type":"FIELD","valueKey":"lmp_date"},{"key":"is_iec_given","type":"FIELD","valueKey":"is_iec_given"},{"key":"reason_for_not_testing","type":"FIELD","valueKey":"reason_for_not_testing"},{"key":"tb_details_id","type":"META_DATA","valueKey":"$formData$.tbData.id"}],"isEventResource":null,"$$hashKey":"object:6624","queryName":"Update TB Screening details","query":"with update_data as (\n    update\n        tuberculosis_screening_details\n    set\n        tuberculosis_symptoms = #tuberculosis_symptoms#,\n        is_tb_testing_done=#is_testing_done#,\n        tb_test_type=#tb_test_type#,\n        is_tb_suspected=#is_tb_suspected#,\n        referral_place = #referral_place#,\n        modified_by = #loggedInUserId#,\n        modified_on = now(),\n        other_tb_symptoms = #other_symptoms#,\n        is_referral_done = case\n            when #is_referral_done# is true then ''YES'' else ''NO'' end,\n        referral_for = #referral_for#,\n        referral_reason = #referral_reason#,\n        started_menstruating = #started_menstruating#,\n        lmp_date = #lmp_date#,  \n        is_iec_given = #is_iec_given#,\n        reason_for_not_testing=#reason_for_not_testing#\n        where\n            id = #tb_details_id#\n            returning tuberculosis_screening_details.id\n        )\n    select\n        id\n    from\n        update_data;"}]'
FROM insert_into_medplat_form_master;


INSERT INTO medplat_form_version_history
("uuid", form_master_uuid, template_config, field_config, "version", created_by, created_on, modified_by, modified_on, form_object, template_css, form_vm, execution_sequence, query_config)
SELECT
	'1ef846b4-53f4-46bc-2607-d700a4d67dab',
	'b2cd45b7-d23a-4ad0-beef-924bd561aca1',
	'[{"type":"CARD","config":{"title":"Basic Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"unique_health_id","fieldName":"Member ID","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"age","fieldName":"Age","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"gender","fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"marital_status","fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"last_method_of_contraception","fieldName":"Last method of contraception used","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_phone_no","fieldName":"Family phone number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_address","fieldName":"Family address","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"birth_cert_number","fieldName":"Birth certificate number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"birth_weight","fieldName":"Birth weight","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"weight","fieldName":"Latest weight","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"member_name","fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"dob","fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"nrc_number","fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"religion","fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp","fieldName":"LMP (Last Menstrual Period) date","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"hiv_status","fieldName":"HIV status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"chronic_disease","fieldName":"Chronic diseases","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"developmental_delay","fieldName":"Developmental delays","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"immunisation_status","fieldName":"Immunization status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]},{"type":"CARD","config":{"title":"TB Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"service_date","fieldName":"Service date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"tuberculosis_symptoms","fieldName":"Symptoms","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"other_tb_symptoms","fieldName":"Other Symptoms","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"started_menstruating","fieldName":"Has person started menstruating?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_referral_done","fieldName":"Is referral required?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"Select Health Infrastructure","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"You will be referred to","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_iec_given","fieldName":"Is IEC (Information, Education and Communication) given","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_tb_suspected","fieldName":"Is TB (Tuberculosis) suspected ?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_tb_testing_done","fieldName":"Is testing done?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"reason_for_not_testing","fieldName":"Reason for not testing","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"tb_test_type","fieldName":"Select test type","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp_date","fieldName":"LMP date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_for","fieldName":"Referral reason","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_reason","fieldName":"Other Referral Reason","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]}]',
	'{"CHIP_TB":{"Age":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"age","hasError":false,"showCard":false,"fieldName":"Age","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Age","errorMsgListKeys":[]},"DOB":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"dob","hasError":false,"showCard":false,"fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"null","displayType":"date","showContent":false,"displayValue":"Date of Birth","errorMsgListKeys":[]},"Gender":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"gender","hasError":false,"showCard":false,"fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Gender","errorMsgListKeys":[]},"LMP date":{"label":"LMP date","events":"null","ngModel":"$formData$.tbData","tooltip":"LMP (Last Menstrual Period) date","fieldKey":"lmp_date","isHidden":"false","fieldName":"LMP date","fieldType":"DATE","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.started_menstruating\",\"queryCode\":null,\"expression\":null},{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$infoData$.memberDetails.is_pregnant\"}]}}","placeholder":"LMP (Last Menstrual Period) date","maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minLmpDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter LMP Date"},"Religion":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"religion","hasError":false,"showCard":false,"fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Religion","errorMsgListKeys":[]},"Symptoms":{"label":"Symptoms","events":"{\"Change\":{\"actions\":[{\"type\":\"FORM_METHOD\",\"value\":\"handleSymptomsChange\",\"continueIfFail\":true}]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Symptoms","fieldKey":"tuberculosis_symptoms","isHidden":"false","fieldName":"Symptoms","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"true","isRequired":"true","requirable":"null","visibility":"null","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"},{\"key\":\"-2\",\"value\":\"None\"}]","listValueField":"tuberculosisSymptoms","requiredMessage":"Please select TB Symptoms","additionalStaticOptionsRequired":"true"},"Member ID":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"unique_health_id","hasError":false,"showCard":true,"fieldName":"Member ID","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member ID","errorMsgListKeys":[]},"HIV status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"hiv_status","hasError":false,"showCard":false,"fieldName":"HIV status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"HIV status","errorMsgListKeys":[]},"NRC Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"nrc_number","hasError":false,"showCard":false,"fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"NRC Number","errorMsgListKeys":[]},"Member Name":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"member_name","hasError":false,"showCard":true,"fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member Name","errorMsgListKeys":[]},"Birth weight":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"birth_weight","fieldName":"Birth weight","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Birth weight (in Kgs)"},"Service date":{"label":"Service date","events":"null","ngModel":"$formData$.tbData","tooltip":"Service date","fieldKey":"service_date","isHidden":"false","fieldName":"Service date","fieldType":"DATE","disability":"null","isDisabled":"true","isRequired":"false","requirable":"null","visibility":"null","placeholder":"Service date","maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minServiceDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter service date"},"Latest weight":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"weight","fieldName":"Latest weight","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Latest weight (in Kgs)"},"Family address":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_address","hasError":false,"showCard":false,"fieldName":"Family address","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family address","errorMsgListKeys":[]},"Marital Status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"marital_status","hasError":false,"showCard":false,"fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Marital Status","errorMsgListKeys":[]},"Other Symptoms":{"label":"Other Symptoms","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Other Symptoms","fieldKey":"other_tb_symptoms","isHidden":"false","fieldName":"Other Symptoms","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$formData$.tbData.tuberculosis_symptoms.includes(''-1'')\"}]}}","placeholder":"Please mention other symptoms","requiredMessage":"Please mention other symptoms"},"Referral reason":{"label":"Referral reason","events":"null","ngModel":"$formData$.tbData","tooltip":"Referral reason","fieldKey":"referral_for","isHidden":"false","fieldName":"Referral reason","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"}]","listValueField":"referalReasonNonRch","requiredMessage":"Please select a referral reason","additionalStaticOptionsRequired":"true"},"Chronic diseases":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"chronic_disease","hasError":false,"showCard":false,"fieldName":"Chronic diseases","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Chronic diseases","errorMsgListKeys":[]},"Is testing done?":{"label":"Is testing done?","events":"null","ngModel":"$formData$.tbData","tooltip":"Is testing done?","fieldKey":"is_tb_testing_done","isHidden":"false","fieldName":"Is testing done?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is testing done?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no"},"Select test type":{"label":"Select test type","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Select test type","fieldKey":"tb_test_type","isHidden":"false","fieldName":"Select test type","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_tb_testing_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--SELECT--","staticOptions":null,"listValueField":"tbTestType","requiredMessage":"Please select atleast 1 test type","additionalStaticOptionsRequired":"false"},"Family phone number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_phone_no","hasError":false,"showCard":false,"fieldName":"Family phone number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family phone number","errorMsgListKeys":[]},"Immunization status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"immunisation_status","fieldName":"Immunization status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"Immunisation status"},"Developmental delays":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"developmental_delay","hasError":false,"showCard":false,"fieldName":"Developmental delays","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"boolean","showContent":false,"displayValue":"Developmental delays","errorMsgListKeys":[]},"Is referral required?":{"label":"Is referral required?","events":"{\"Change\":{\"actions\":[{\"type\":\"FORM_METHOD\",\"value\":\"setUserHealthinfra\",\"continueIfFail\":true}]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Is referral required?","fieldKey":"is_referral_done","isHidden":"false","fieldName":"Is referral required?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is referral required?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select yes or no"},"Other Referral Reason":{"label":"Other Referral Reason","events":"null","ngModel":"$formData$.tbData","tooltip":"Other Referral Reason","fieldKey":"referral_reason","isHidden":"false","fieldName":"Other Referral Reason","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$formData$.tbData.referral_for.includes(''-1'')\"},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Other Referral Reason","requiredMessage":"Please enter other referral reason"},"Reason for not testing":{"label":"Reason for not testing","events":"{\"Change\":{\"actions\":[]},\"Blur\":{\"actions\":[]},\"MouseEnter\":{\"actions\":[]},\"MouseLeave\":{\"actions\":[]},\"KeyPress\":{\"actions\":[]},\"KeyUp\":{\"actions\":[]},\"KeyDown\":{\"actions\":[]},\"Click\":{\"actions\":[]}}","ngModel":"$formData$.tbData","tooltip":"Reason for not testing","fieldKey":"reason_for_not_testing","hasError":false,"isHidden":"false","showCard":false,"fieldName":"Reason for not testing","fieldType":"SHORT_TEXT","maxLength":"99","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"false\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_tb_testing_done\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Reason for not testing","showContent":false,"requiredMessage":"Please enter reason for not testing","errorMsgListKeys":[]},"You will be referred to":{"events":"null","ngModel":"$formData$.tbData","fieldKey":"referral_place","fieldName":"You will be referred to","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra === $formData$.tbData.referral_place[0]\"},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","displayValue":"You will be referred to"},"Birth certificate number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"birth_cert_number","hasError":false,"showCard":false,"fieldName":"Birth certificate number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"5\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Birth certificate number","errorMsgListKeys":[]},"Select Health Infrastructure":{"label":"Health Infrastructure","events":"null","ngModel":"$formData$.tbData","tooltip":"Select Health Infrastructure","fieldKey":"referral_place","isHidden":"false","fieldName":"Select Health Infrastructure","fieldType":"DROPDOWN","disability":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra.health_infrastrucutre_id && $formData$.tbData.referral_place && $utilityData$.userHealthInfra.health_infrastrucutre_id === $formData$.tbData.referral_place\"}]}}","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"variableList","placeholder":"--SELECT--","variableList":"$utilityData$.healthInfraList","staticOptions":null,"requiredMessage":"Please search and select Health Infrastructure","additionalStaticOptionsRequired":"false"},"Has person started menstruating?":{"label":"Has person started menstruating?","events":"null","ngModel":"$formData$.tbData","tooltip":"Has person started menstruating?","fieldKey":"started_menstruating","hasError":false,"isHidden":"false","showCard":false,"fieldName":"Has person started menstruating?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"false","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"50\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"null\",\"value2\":null,\"fieldName\":\"$formData$.tbData.lmp_date\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"staticOptions","placeholder":"Has person started menstruating?","showContent":false,"staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":null,"errorMsgListKeys":[]},"Is TB (Tuberculosis) suspected ?":{"label":"Is TB (Tuberculosis) suspected ?","events":"null","ngModel":"$formData$.tbData","tooltip":"Is TB (Tuberculosis) suspected ?","fieldKey":"is_tb_suspected","isHidden":"false","fieldName":"Is TB (Tuberculosis) suspected ?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is TB (Tuberculosis) suspected ?","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no"},"LMP (Last Menstrual Period) date":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"lmp","hasError":false,"showCard":false,"fieldName":"LMP (Last Menstrual Period) date","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"''Female''\",\"value2\":null,\"fieldName\":\"$infoData$.memberDetails.gender\",\"queryCode\":null,\"expression\":null},{\"type\":\"FIELD\",\"operator\":\"EQ\",\"value1\":\"true\",\"value2\":null,\"fieldName\":\"$formData$.tbData.started_menstruating\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"date","showContent":false,"displayValue":"LMP (Last Menstrual Period) date","errorMsgListKeys":[]},"Last method of contraception used":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"last_method_of_contraception","hasError":false,"showCard":false,"fieldName":"Last method of contraception used","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Last method of contraception used","errorMsgListKeys":[]},"Is IEC (Information, Education and Communication) given":{"label":"Is IEC (Information, Education and Communication) given","events":"null","ngModel":"$formData$.tbData","tooltip":"Is IEC given","fieldKey":"is_iec_given","isHidden":"false","fieldName":"Is IEC (Information, Education and Communication) given","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"Is IEC given","staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select if IEC given"}}}',
	'DRAFT',
	97104,
	now(),
	97104,
	now(),
	'[{"title":"$formData$","isArray":false,"nodes":[{"title":"tbData","nodes":[],"indexAlias":null,"$$hashKey":"object:826","path":"$formData$.tbData","backendConfigPath":"$formData$.tbData"}],"path":"$formData$","backendConfigPath":"$formData$","$$hashKey":"object:810"},{"title":"$infoData$","isArray":false,"nodes":[{"title":"memberDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:838","path":"$infoData$.memberDetails","backendConfigPath":"$infoData$.memberDetails"}],"path":"$infoData$","backendConfigPath":"$infoData$","$$hashKey":"object:811"}]',
	'label {
    white-space: normal !important;
    line-height: 1.2 !important;
}',
	'{"formVariables":[{"value":"userHealthInfra","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setUserHealthInfra","setterMethodCode":"(function setUserHealthInfra() {\nconsole.log($utilityData$.userHealthInfra)\n\t/**\n\t* Setter method for $utilityData$.userHealthInfra (NUMBER)\n\t* Please see example below on how to set the value\n\t* $utilityData$.userHealthInfra = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"minLmpDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinLmpDate","setterMethodCode":"(function setMinLmpDate() {\n\n$utilityData$.minLmpDate = $infoData$.memberDetails.is_pregnant ? moment().subtract(9, ''months'') : moment().subtract(35, ''days'');\n\n});"},{"value":"ageInYears","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setAgeInYears","setterMethodCode":"(function setAgeInYears() {\n\n    let ageParts = $infoData$.memberDetails.age.split('' '');\n    let years = 0;\n    if (ageParts.length < 6) {\n        years = 0\n    }\n    else {\n        years = isNaN(parseInt(ageParts[0])) ? 0 : parseInt(ageParts[0]);\n    }\n    $utilityData$.ageInYears = years;\n\t\n});"},{"value":"minServiceDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinServiceDate","setterMethodCode":"(function setMinServiceDate() {\n    $utilityData$.minServiceDate = $formData$.tbData.service_date ? moment($formData$.tbData.service_date) : moment().subtract(9, ''months'');\n});"},{"value":"healthInfraList","type":"ARRAY","bindTo":"$utilityData$","setter":true,"setterMethodName":"setHealthInfraList","setterMethodCode":"(function setHealthInfraList() {\n\n\t/**\n\t* Setter method for $utilityData$.healthInfraList (ARRAY)\n\t* Please see example below on how to set the value\n\t* $utilityData$.healthInfraList = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"isChildImmunisedInOneYear","type":"BOOLEAN","bindTo":"$utilityData$","setter":true,"setterMethodName":"setIsChildImmunisedInOneYear","setterMethodCode":"(function setIsChildImmunisedInOneYear() {\n    const childDetails = $infoData$.memberDetails\n        if (childDetails.immunisation_given != null && childDetails.immunisation_given.length > 0) {\n            const immunisationGiven = childDetails.immunisation_given.split(\",\")\n            const immunisationList = []\n\n            for (let immunisation of immunisationGiven) {\n                immunisationList.push(immunisation.split(\"#\")[0])\n            }\n\n\n            if (immunisationList.length) {\n                if (\n                    immunisationList.includes(\"BCG\")\n                    && immunisationList.includes(\"OPV_1\")\n                    && immunisationList.includes(\"OPV_2\")\n                    && immunisationList.includes(\"OPV_3\")\n                    && (immunisationList.includes(\"PENTA_1\") || immunisationList.includes(\"DPT_1\"))\n                    && (immunisationList.includes(\"PENTA_2\") || immunisationList.includes(\"DPT_2\"))\n                    && (immunisationList.includes(\"PENTA_3\") || immunisationList.includes(\"DPT_3\"))\n                    && (immunisationList.includes(\"MEASLES_RUBELLA_1\") || immunisationList.includes(\"MEASLES_1\"))) {\n                    $utilityData$.isChildImmunisedInOneYear = true;\n                } else {\n                    $utilityData$.isChildImmunisedInOneYear = false;\n                }\n            } else {\n                $utilityData$.isChildImmunisedInOneYear = false;\n            }\n        } else {\n            $utilityData$.isChildImmunisedInOneYear = false;\n        }\n});"},{"value":"isChildImmunisedInTwoYear","type":"BOOLEAN","bindTo":"$utilityData$","setter":true,"setterMethodName":"setIsChildImmunisedInTwoYear","setterMethodCode":"(function setIsChildImmunisedInTwoYear() {\n    const childDetails = $infoData$.memberDetails\n        if (childDetails.immunisation_given != null && childDetails.immunisation_given.length > 0) {\n            const immunisationGiven = childDetails.immunisation_given.split(\",\")\n            const immunisationList = []\n\n            for (let immunisation of immunisationGiven) {\n                immunisationList.push(immunisation.split(\"#\")[0])\n            }\n\n            if (immunisationList.length) {\n                if (\n                    immunisationList.includes(\"BCG\")\n                    && immunisationList.includes(\"VITTAMIN_A_50000\")\n                    && immunisationList.includes(\"VITTAMIN_A_100000\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_1\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_2\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_3\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_4\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_5\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_6\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_7\")\n                    && immunisationList.includes(\"VITTAMIN_A_200000_8\")\n                    && immunisationList.includes(\"OPV_0\")\n                    && immunisationList.includes(\"OPV_1\")\n                    && immunisationList.includes(\"OPV_2\")\n                    && immunisationList.includes(\"OPV_3\")\n                    && immunisationList.includes(\"PCV_1\")\n                    && immunisationList.includes(\"PCV_2\")\n                    && immunisationList.includes(\"PCV_3\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_1\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_2\")\n                    && immunisationList.includes(\"DPT_HEB_HIB_3\")\n                    && immunisationList.includes(\"ROTA_VACCINE_1\")\n                    && immunisationList.includes(\"MEASLES_RUBELLA_1\")\n                    && immunisationList.includes(\"MEASLES_RUBELLA_2\")) {\n                    $utilityData$.isChildImmunisedInTwoYear = true;\n                } else {\n                    $utilityData$.isChildImmunisedInTwoYear = false;\n                }\n            } else {\n                $utilityData$.isChildImmunisedInTwoYear = false;\n            }\n        } else {\n            $utilityData$.isChildImmunisedInTwoYear = false;\n        }\n});"}],"formMethods":[{"value":"setSymptoms","code":"(function setSymptoms() {\n\t$formData$.tbData.tuberculosis_symptoms = $formData$.tbData?.tuberculosis_symptoms?.split('','').map(data => {\n       if (![''-1'', ''-2''].includes(data)) {\n           return parseInt(data);\n       } else {\n           return data;\n       }\n    });\n});"},{"value":"setTbTestType","code":"(function setTbTestType() {\n\t$formData$.tbData.tb_test_type = $formData$.tbData.tb_test_type.split('','').map(data => parseInt(data));\n});"},{"value":"setUserHealthinfra","code":"(function setUserHealthInfra() {\n    $formData$.tbData.referral_place = $formData$.tbData.is_referral_done && $utilityData$.userHealthInfra ? $utilityData$.userHealthInfra.health_infrastrucutre_id : null\n});"},{"value":"handleSymptomsChange","code":"(function handleSymptomsChange() {\n    if ($formData$.tbData?.tuberculosis_symptoms?.length > 0\n        && $formData$.tbData?.tuberculosis_symptoms?.includes(''-2'')) {\n        $formData$.tbData.tuberculosis_symptoms = [''-2''];\n    }\n});"},{"value":"setImmunisationStatus","code":"(function setImmunisationStatus() {\n\tconst dobDate = new Date($infoData$.memberDetails.dob);\n    const currentDate = new Date();\n    \n    let age = currentDate.getFullYear() - dobDate.getFullYear();\n    const monthDiff = currentDate.getMonth() - dobDate.getMonth();\n    const dayDiff = currentDate.getDate() - dobDate.getDate();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {\n        age--;\n    }\n\n    if (age < 1) {\n        $infoData$.memberDetails.immunisation_status = ''Not fully immunised''\n    } else if (age >= 1 && age <= 2) {\n        $infoData$.memberDetails.immunisation_status = $utilityData$.isChildImmunisedInOneYear ? ''Fully immunised'' : ''Not fully immunised''\n    } else {\n        $infoData$.memberDetails.immunisation_status = $utilityData$.isChildImmunisedInTwoYear ? ''Fully immunised'' : ''Not fully immunised''\n    }\n});"},{"value":"setDropdownValues","code":"(function setDropdownValues() {\n\tif ($formData$.tbData?.referral_for) {\n        $formData$.tbData.referral_for === -1 && ($formData$.tbData.referral_for = ''-1'');\n\t}\n});"}],"formQueries":[{"value":"Get Member Details","queryCode":"get_member_details","params":"memberId","paramConfig":"{\"memberId\":\"$formData$.tbData.member_id\"}","query":"with hof_det as (\nselect im.mobile_number \nfrom imt_member im\nwhere im.family_id = (select family_id from imt_member where id = #memberId#)\nand im.family_head\n)\nselect \n\tim.id, im.unique_health_id, \n\tim.family_id, concat_ws('' '', im.first_name, im.middle_name, im.last_name) as member_name, \n\tim.dob, \n\t(select value from listvalue_field_value_detail where id = im.marital_status) as marital_status,\n    (select value from listvalue_field_value_detail where cast(id as text) = im.member_religion) as religion,\n\tcast(age(current_date, im.dob) as text) as age,\n\tim.nrc_number, \n\tim.last_method_of_contraception, im.lmp,\n\tcast(im.additional_info as json)->> ''hivTest'' as hiv_status,\n    (select string_agg(value, '', '')  from listvalue_field_value_detail lfvd \n    where cast(id as text) in (select unnest(string_to_array(im.chronic_disease,'','')))) as chronic_disease,\n    im.birth_cert_number,\n    im.mother_name,\n    im.birth_weight,\n    im.weight,\n    im.is_pregnant,\n    im.immunisation_given,\n    cast(im.additional_info as json)->> ''developmentalDelays'' as developmental_delay,\n    cast(im.additional_info as json)->> ''lastServiceLongGate'' as last_service_date,\n    (select mobile_number from hof_det) as family_phone_no,\n\tcase when im.gender = ''F'' then ''Female'' else ''Male'' end as gender,\n\tconcat_ws('' '', if2.house_number, if2.address1, if2.address2) as family_address,\n\tif2.area_id, if2.location_id \nfrom \n\timt_member im \ninner join \n\timt_family if2 on im.family_id = if2.family_id \nwhere \n\tim.id = #memberId#;","response":"$infoData$.memberDetails","isResultArray":null,"successMessage":null,"failureMessage":"Member not found.","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get User Health Infra","queryCode":"get_user_health_infra","params":"userID","paramConfig":"{\"userID\":\"$loggedInUserId$\"}","query":"select health_infrastrucutre_id from user_health_infrastructure where user_id = #userID# and is_default = true;","response":"$utilityData$.userHealthInfra","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":false,"isField":null,"isPagination":false},{"value":"Get Member TB Details","queryCode":"get_mem_tb_det","params":"tb_screening_id","paramConfig":"{\"tb_screening_id\":\"$stateParams$.id\"}","query":"select \n    tsd.id,\n    tsd.member_id,\n    tsd.tuberculosis_symptoms as tuberculosis_symptoms,\n    tsd.other_tb_symptoms,\n    tsd.started_menstruating,\n    tsd.lmp_date,\n    case when tsd.is_referral_done = ''YES'' then true \n    else false end as is_referral_done,\n    cast (tsd.referral_place as text) as referral_place,\n    cast(tsd.referral_for as integer) as referral_for,\n    tsd.referral_reason,\n    tsd.is_iec_given,\n    tsd.is_tb_testing_done,\n    cast(tsd.tb_test_type as integer) tb_test_type,\n    tsd.is_tb_suspected,\n    tsd.is_tb_cured,\n    tsd.reason_for_not_testing\nfrom tuberculosis_screening_details tsd \nwhere tsd.id = #tb_screening_id#\nand form_type = ''TB_SCREENING''\norder by modified_on desc limit 1;","response":"$formData$.tbData","isResultArray":null,"successMessage":null,"failureMessage":"Screening records not found","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get health infra list","queryCode":"get_health_infra_list","params":"","paramConfig":"{}","query":"select  h.name , h.id,h.type as type from health_infrastructure_details h;\n","response":"$utilityData$.healthInfraList","isResultArray":true,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":true,"isPagination":false,"dropdownKey":"id","dropdownValue":"name","toVariable":true}]}',
	'[{"type":"FORM_QUERY","value":"Get Member TB Details","continueIfFail":false},{"type":"FORM_QUERY","value":"Get Member Details","continueIfFail":false},{"type":"FORM_VARIABLE_SETTER","value":"ageInYears","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minServiceDate","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"isChildImmunisedInOneYear","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"isChildImmunisedInTwoYear","continueIfFail":true},{"type":"FORM_METHOD","value":"setDropdownValues","continueIfFail":true},{"type":"FORM_METHOD","value":"setImmunisationStatus","continueIfFail":true},{"type":"FORM_METHOD","value":"setSymptoms","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minLmpDate","continueIfFail":true},{"type":"FORM_QUERY","value":"Get User Health Infra","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"userHealthInfra","continueIfFail":true},{"type":"FORM_QUERY","value":"Get health infra list","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"healthInfraList","continueIfFail":true},{"type":"FORM_METHOD","value":"setUserHealthinfra","continueIfFail":true}]',
	'[{"queryCode":"update_tb_scr_det","hasLoop":null,"queryPath":"$formData$.tbData","subQueries":[],"params":[{"key":"tuberculosis_symptoms","type":"FIELD","valueKey":"tuberculosis_symptoms"},{"key":"is_testing_done","type":"FIELD","valueKey":"is_tb_testing_done"},{"key":"tb_test_type","type":"FIELD","valueKey":"tb_test_type"},{"key":"is_tb_suspected","type":"FIELD","valueKey":"is_tb_suspected"},{"key":"referral_place","type":"FIELD","valueKey":"referral_place"},{"key":"other_symptoms","type":"FIELD","valueKey":"other_tb_symptoms"},{"key":"is_referral_done","type":"FIELD","valueKey":"is_referral_done"},{"key":"referral_for","type":"FIELD","valueKey":"referral_for"},{"key":"referral_reason","type":"FIELD","valueKey":"referral_reason"},{"key":"started_menstruating","type":"FIELD","valueKey":"started_menstruating"},{"key":"lmp_date","type":"FIELD","valueKey":"lmp_date"},{"key":"is_iec_given","type":"FIELD","valueKey":"is_iec_given"},{"key":"reason_for_not_testing","type":"FIELD","valueKey":"reason_for_not_testing"},{"key":"tb_details_id","type":"META_DATA","valueKey":"$formData$.tbData.id"}],"isEventResource":null,"$$hashKey":"object:6624","queryName":"Update TB Screening details","query":"with update_data as (\n    update\n        tuberculosis_screening_details\n    set\n        tuberculosis_symptoms = #tuberculosis_symptoms#,\n        is_tb_testing_done=#is_testing_done#,\n        tb_test_type=#tb_test_type#,\n        is_tb_suspected=#is_tb_suspected#,\n        referral_place = #referral_place#,\n        modified_by = #loggedInUserId#,\n        modified_on = now(),\n        other_tb_symptoms = #other_symptoms#,\n        is_referral_done = case\n            when #is_referral_done# is true then ''YES'' else ''NO'' end,\n        referral_for = #referral_for#,\n        referral_reason = #referral_reason#,\n        started_menstruating = #started_menstruating#,\n        lmp_date = #lmp_date#,  \n        is_iec_given = #is_iec_given#,\n        reason_for_not_testing=#reason_for_not_testing#\n        where\n            id = #tb_details_id#\n            returning tuberculosis_screening_details.id\n        )\n    select\n        id\n    from\n        update_data;"}]'
ON CONFLICT (form_master_uuid, "version")
DO UPDATE
SET
	form_master_uuid=EXCLUDED.form_master_uuid,
	template_config=EXCLUDED.template_config,
	field_config=EXCLUDED.field_config,
	"version"=EXCLUDED."version",
	created_by=EXCLUDED.created_by,
	created_on=EXCLUDED.created_on,
	modified_by=EXCLUDED.modified_by,
	modified_on=EXCLUDED.modified_on,
	form_object=EXCLUDED.form_object,
	template_css=EXCLUDED.template_css,
	form_vm=EXCLUDED.form_vm,
	execution_sequence=EXCLUDED.execution_sequence,
	query_config=EXCLUDED.query_config;