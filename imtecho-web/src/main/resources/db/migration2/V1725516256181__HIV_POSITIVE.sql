with insert_into_medplat_form_master as (
	INSERT INTO medplat_form_master
	("uuid", form_name, form_code, current_version, state, created_by, created_on, modified_by, modified_on, menu_config_id)
	SELECT 
		'52754711-6816-4126-a178-ab0b76708460',
		'HIV_POSITIVE',
		'HIV_POSITIVE',
		'1',
		'ACTIVE',
		97104,
		now(),
		97104,
		now(),
		393
	ON CONFLICT (form_code)
	DO UPDATE 
	SET
		uuid=EXCLUDED."uuid",
		form_name=EXCLUDED.form_name,
		current_version=cast(cast(coalesce((select max(cast(medplat_form_version_history.version as integer)) from medplat_form_master inner join medplat_form_version_history on medplat_form_master.uuid  = medplat_form_version_history.form_master_uuid where medplat_form_master.form_code = EXCLUDED.form_code and medplat_form_version_history.version <> 'DRAFT'),'0') as integer) + 1 as text),
		state=EXCLUDED.state,
		created_by=EXCLUDED.created_by, 
		created_on=EXCLUDED.created_on, 
		modified_by=EXCLUDED.modified_by, 
		modified_on=EXCLUDED.modified_on, 
		menu_config_id=EXCLUDED.menu_config_id
	returning medplat_form_master.current_version
)
INSERT INTO medplat_form_version_history
("uuid", form_master_uuid, template_config, field_config, "version", created_by, created_on, modified_by, modified_on, form_object, template_css, form_vm, execution_sequence, query_config)
SELECT
	'a7f29833-ef8d-cdd5-fd0b-1d99cb266f6a',
	'52754711-6816-4126-a178-ab0b76708460',
	'[{"type":"CARD","config":{"title":"MEMBER DETAILS","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"unique_health_id","fieldName":"Unique Health ID","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"member_name","fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"age","fieldName":"Age","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"dob","fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"last_method_of_contraception","fieldName":"Last method of contraception","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"chronic_disease","fieldName":"Chronic Diseases","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_address","fieldName":"Family Address","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"gender","fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"religion","fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"nrc_number","fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"marital_status","fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"hiv_display","fieldName":"HIV Display","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp","fieldName":"LMP Date","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_phone_number","fieldName":"Family Phone Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]},{"type":"CARD","config":{"title":"Screening Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"service_date","fieldName":"Service Date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"Health Infrastructue","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_reason","fieldName":"Referral reason","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"other_referral_reason","fieldName":"Other referral reason","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_art_done","fieldName":"Are you on ART (Anti-Retroviral Therapy) ?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_referral_done","fieldName":"Is referral required ?","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"User health facility","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]}]',
	'{"HIV_POSITIVE":{"Age":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"age","hasError":false,"showCard":true,"fieldName":"Age","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Age","errorMsgListKeys":[]},"DOB":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"dob","hasError":false,"showCard":true,"fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"null","displayType":"date","showContent":false,"displayValue":"Date of Birth","errorMsgListKeys":[]},"Gender":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"gender","hasError":false,"showCard":true,"fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Gender","errorMsgListKeys":[]},"LMP Date":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"lmp","hasError":false,"showCard":true,"fieldName":"LMP Date","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$infoData$.memberDetails.gender === ''F''\"}]}}","displayType":"text","showContent":false,"displayValue":"LMP Date","errorMsgListKeys":[]},"Religion":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"religion","hasError":false,"showCard":true,"fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Religion","errorMsgListKeys":[]},"NRC Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"nrc_number","hasError":false,"showCard":true,"fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"NRC Number","errorMsgListKeys":[]},"HIV Display":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"hiv_display","hasError":false,"showCard":true,"fieldName":"HIV Display","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"HIV Display","errorMsgListKeys":[]},"Member Name":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"member_name","hasError":false,"showCard":true,"fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member Name","errorMsgListKeys":[]},"Service Date":{"label":"Service Date","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Service Date","fieldKey":"service_date","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Service Date","fieldType":"DATE","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","placeholder":"Service Date","showContent":false,"maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minServiceDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter service date","errorMsgListKeys":[]},"Family Address":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_address","hasError":false,"showCard":true,"fieldName":"Family Address","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family Address","errorMsgListKeys":[]},"Marital Status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"value","hasError":false,"showCard":true,"fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Marital Status","errorMsgListKeys":[]},"Referral reason":{"label":"Referral reason","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Referral reason","fieldKey":"referral_reason","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Referral reason","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''YES''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--select--","showContent":false,"staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"}]","listValueField":"referalReasonNonRch","requiredMessage":"Please select referral reason","errorMsgListKeys":[],"additionalStaticOptionsRequired":"true"},"Chronic Diseases":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"chronic_disease","hasError":false,"showCard":true,"fieldName":"Chronic Diseases","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Chronic Diseases","errorMsgListKeys":[]},"Unique Health ID":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"unique_health_id","hasError":false,"showCard":true,"fieldName":"Unique Health ID","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member ID","errorMsgListKeys":[]},"Family Phone Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_phone_number","hasError":false,"showCard":true,"fieldName":"Family Phone Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family Phone Number","errorMsgListKeys":[]},"Health Infrastructue":{"label":"Health infrastructure","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Select health infrastructure","fieldKey":"referral_place","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Health Infrastructue","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''YES''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"variableList","placeholder":"-- select --","showContent":false,"variableList":"$utilityData$.healthInfraList","staticOptions":null,"requiredMessage":"Please search and select health infrastructure","errorMsgListKeys":[],"additionalStaticOptionsRequired":"false"},"User health facility":{"events":"null","ngModel":"$formData$.hivDetails","fieldKey":"referral_place","hasError":false,"showCard":true,"fieldName":"User health facility","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra?.health_infrastrucutre_id !== null\"}]}}","displayType":"text","showContent":false,"displayValue":"You will be referred to following health facility","errorMsgListKeys":[]},"Other referral reason":{"label":"Other referral reason","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Other referral reason","fieldKey":"other_referral_reason","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Other referral reason","fieldType":"SHORT_TEXT","maxLength":"100","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''-1''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.referral_reason\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Other referral reason","showContent":false,"requiredMessage":"Please enter other referral reason","errorMsgListKeys":[]},"Is referral required ?":{"label":"Is referral required ?","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Is referral required ?","fieldKey":"is_referral_done","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Is referral required ?","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"-- Select Is referral required --","showContent":false,"staticOptions":"[{\"key\":\"YES\",\"value\":\"Yes\"},{\"key\":\"NO\",\"value\":\"No\"}]","requiredMessage":"Select is referral required","errorMsgListKeys":[],"additionalStaticOptionsRequired":"false"},"Last method of contraception":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"last_method_of_contraception","hasError":false,"showCard":true,"fieldName":"Last method of contraception","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Last method of contraception","errorMsgListKeys":[]},"Are you on ART (Anti-Retroviral Therapy) ?":{"label":"ART status?","events":"null","ngModel":"$formData$.hivDetails","tooltip":"ART status","fieldKey":"is_art_done","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Are you on ART (Anti-Retroviral Therapy) ?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"ART done?","showContent":false,"staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no","errorMsgListKeys":[]}}}',
	current_version,
	97104,
	now(),
	97104,
	now(),
	'[{"title":"$formData$","isArray":false,"nodes":[{"title":"hivDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:1116","path":"$formData$.hivDetails","backendConfigPath":"$formData$.hivDetails"}],"path":"$formData$","backendConfigPath":"$formData$","$$hashKey":"object:2774"},{"title":"$infoData$","isArray":false,"nodes":[{"title":"memberDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:2790","path":"$infoData$.memberDetails","backendConfigPath":"$infoData$.memberDetails"}],"path":"$infoData$","backendConfigPath":"$infoData$","$$hashKey":"object:2775"}]',
	null,
	'{"formVariables":[{"value":"ageInYears","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setAgeInYears","setterMethodCode":"(function setAgeInYears() {\n\n\tlet ageParts = $infoData$.memberDetails.age.split('' '');\n    let years = isNaN(parseInt(ageParts[0])) ? 0 : parseInt(ageParts[0]);\n    $utilityData$.ageInYears = years;\n    console.log($utilityData$.ageInYears)\n\t\n});"},{"value":"minLmpDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinLmpDate","setterMethodCode":"(function setMinLmpDate() {\n\n$utilityData$.minLmpDate = $infoData$.memberDetails.is_pregnant ? moment().subtract(9, ''months'') : moment().subtract(35, ''days'');\nconsole.log($infoData$.memberDetails.gender === ''F'')\n});"},{"value":"minServiceDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinServiceDate","setterMethodCode":"(function setMinServiceDate() {\n\n\t$utilityData$.minServiceDate = $formData$.hivDetails.service_date ? moment($formData$.hivDetails.service_date) : moment().subtract(9, ''months'');\n\t\n});"},{"value":"userHealthInfra","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setUserHealthInfra","setterMethodCode":"(function setUserHealthInfra() {\n\n\t/**\n\t* Setter method for $utilityData$.userHealthInfra (NUMBER)\n\t* Please see example below on how to set the value\n\t* $utilityData$.userHealthInfra = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"healthInfraList","type":"ARRAY","bindTo":"$utilityData$","setter":true,"setterMethodName":"setHealthInfraList","setterMethodCode":"(function setHealthInfraList() {\n\n\t/**\n\t* Setter method for $utilityData$.healthInfraList (ARRAY)\n\t* Please see example below on how to set the value\n\t* $utilityData$.healthInfraList = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"}],"formMethods":[],"formQueries":[{"value":"Get Member Details","queryCode":"get_member_details","params":"member_id","paramConfig":"{\"member_id\":\"$stateParams$.id\"}","query":"select im.unique_health_id,concat_ws('' '', im.first_name,im.middle_name,im.last_name) as member_name,im.dob,im.gender,lfvd.value,im.religion,im.nrc_number,cast(age(current_date, im.dob) as text) as age,im.lmp,im.last_method_of_contraception,cast(im.additional_info as json)->> ''hivTest'' as hiv_status,\nim.chronic_disease,concat_ws('' '',imf.house_number,imf.address1, imf.address2) as family_address,im.mobile_number as family_phone_number from imt_member im inner join listvalue_field_value_detail lfvd on im.marital_status=lfvd.id inner join imt_family imf on im.family_id=imf.family_id where im.id=#member_id#;","response":"$infoData$.memberDetails","isResultArray":null,"successMessage":null,"failureMessage":"Member details not found","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get User Health Infra","queryCode":"get_user_health_infra","params":"userID","paramConfig":"{\"userID\":\"$loggedInUserId$\"}","query":"select health_infrastrucutre_id from user_health_infrastructure where user_id = #userID# and is_default = true;","response":"$utilityData$.userHealthInfra","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":null,"isPagination":false},{"value":"Get health infra","queryCode":"get_health_infra","params":"","paramConfig":"{}","query":"select  h.name , h.id,h.type as type from health_infrastructure_details h;","response":"$utilityData$.healthInfraList","isResultArray":true,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":true,"isPagination":false,"dropdownKey":"id","dropdownValue":"name","toVariable":true},{"value":"Get hiv member details","queryCode":"get_hiv_mem_details","params":"memberId","paramConfig":"{\"memberId\":\"$stateParams$.id\"}","query":"select \n    id,\n    service_date,\n    is_art_done, \n    cast(referral_place as integer) as referral_place,\n    cast(referral_for as integer) as referral_reason,\n    referral_reason as other_referral_reason,\n    is_referral_done \n    from rch_preg_hiv_positive_master where\nmember_id=#memberId#;","response":"$formData$.hivDetails","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":true,"isField":null,"isPagination":false}]}',
	'[{"type":"FORM_QUERY","value":"Get Member Details","continueIfFail":false},{"type":"FORM_QUERY","value":"Get hiv member details"},{"type":"FORM_VARIABLE_SETTER","value":"ageInYears","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minLmpDate","continueIfFail":true},{"type":"FORM_QUERY","value":"Get User Health Infra"},{"type":"FORM_QUERY","value":"Get health infra"}]',
	'[{"queryCode":"update_hiv_details","hasLoop":null,"queryPath":"$formData$.hivDetails","subQueries":[],"params":[{"key":"service_date","type":"FIELD","valueKey":"service_date"},{"key":"is_referral_done","type":"FIELD","valueKey":"is_referral_done"},{"key":"is_art_done","type":"FIELD","valueKey":"is_art_done"},{"key":"referral_place","type":"FIELD","valueKey":"referral_place"},{"key":"referral_reason","type":"FIELD","valueKey":"referral_reason"},{"key":"other_referral_reason","type":"FIELD","valueKey":"other_referral_reason"},{"key":"hiv_details_id","type":"META_DATA","valueKey":"$formData$.hivDetails.id"}],"isEventResource":null,"$$hashKey":"object:5584","queryName":"Update HIV members","query":"with updated_data as (\n    update rch_preg_hiv_positive_master\n    set service_date = #service_date#,\n    is_referral_done = #is_referral_done#,\n    is_art_done = #is_art_done#,\n    referral_place = #referral_place#,\n    modified_by = #loggedInUserId#,\n    referral_for=#referral_reason#,\n    referral_reason=  #other_referral_reason#,\n    modified_on = now()\n    where id=#hiv_details_id#\n    returning rch_preg_hiv_positive_master.id\n) select id from updated_data;"}]'
FROM insert_into_medplat_form_master;


INSERT INTO medplat_form_version_history
("uuid", form_master_uuid, template_config, field_config, "version", created_by, created_on, modified_by, modified_on, form_object, template_css, form_vm, execution_sequence, query_config)
SELECT
	'dfe758cf-6a84-2e5f-f728-31aa4b852598',
	'52754711-6816-4126-a178-ab0b76708460',
	'[{"type":"CARD","config":{"title":"MEMBER DETAILS","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"unique_health_id","fieldName":"Unique Health ID","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"member_name","fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"age","fieldName":"Age","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"dob","fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"last_method_of_contraception","fieldName":"Last method of contraception","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"chronic_disease","fieldName":"Chronic Diseases","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_address","fieldName":"Family Address","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"gender","fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"religion","fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"nrc_number","fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"marital_status","fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"hiv_display","fieldName":"HIV Display","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"lmp","fieldName":"LMP Date","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"family_phone_number","fieldName":"Family Phone Number","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]},{"type":"CARD","config":{"title":"Screening Details","size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null,"isCollapsible":false},"elements":[{"type":"ROW","config":{"size":"12","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"service_date","fieldName":"Service Date","fieldType":"DATE","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"Health Infrastructue","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_reason","fieldName":"Referral reason","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"other_referral_reason","fieldName":"Other referral reason","fieldType":"SHORT_TEXT","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]},{"type":"COL","config":{"size":"6","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null},"elements":[{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_art_done","fieldName":"Are you on ART (Anti-Retroviral Therapy) ?","fieldType":"RADIO","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"is_referral_done","fieldName":"Is referral required ?","fieldType":"DROPDOWN","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}},{"type":"TECHO_FORM_FIELD","elements":[],"isAdded":false,"config":{"fieldKey":"referral_place","fieldName":"User health facility","fieldType":"INFORMATION_DISPLAY","cssStyles":null,"cssClasses":null,"isRepeatable":false,"showAddRemoveButton":false,"ngModel":null,"isConditional":false,"ngIf":null}}]}]}]}]',
	'{"HIV_POSITIVE":{"Age":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"age","hasError":false,"showCard":true,"fieldName":"Age","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Age","errorMsgListKeys":[]},"DOB":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"dob","hasError":false,"showCard":true,"fieldName":"DOB","fieldType":"INFORMATION_DISPLAY","dateFormat":"dd/MM/yyyy","disability":"null","requirable":"null","visibility":"null","displayType":"date","showContent":false,"displayValue":"Date of Birth","errorMsgListKeys":[]},"Gender":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"gender","hasError":false,"showCard":true,"fieldName":"Gender","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Gender","errorMsgListKeys":[]},"LMP Date":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"lmp","hasError":false,"showCard":true,"fieldName":"LMP Date","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$infoData$.memberDetails.gender === ''F''\"}]}}","displayType":"text","showContent":false,"displayValue":"LMP Date","errorMsgListKeys":[]},"Religion":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"religion","hasError":false,"showCard":true,"fieldName":"Religion","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Religion","errorMsgListKeys":[]},"NRC Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"nrc_number","hasError":false,"showCard":true,"fieldName":"NRC Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"NRC Number","errorMsgListKeys":[]},"HIV Display":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"hiv_display","hasError":false,"showCard":true,"fieldName":"HIV Display","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"HIV Display","errorMsgListKeys":[]},"Member Name":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"member_name","hasError":false,"showCard":true,"fieldName":"Member Name","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member Name","errorMsgListKeys":[]},"Service Date":{"label":"Service Date","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Service Date","fieldKey":"service_date","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Service Date","fieldType":"DATE","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","placeholder":"Service Date","showContent":false,"maxDateField":"{\"key\":\"$today$\",\"type\":\"VARIABLE\"}","minDateField":"{\"key\":\"$utilityData$.minServiceDate\",\"type\":\"VARIABLE\"}","requiredMessage":"Please enter service date","errorMsgListKeys":[]},"Family Address":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_address","hasError":false,"showCard":true,"fieldName":"Family Address","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family Address","errorMsgListKeys":[]},"Marital Status":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"value","hasError":false,"showCard":true,"fieldName":"Marital Status","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Marital Status","errorMsgListKeys":[]},"Referral reason":{"label":"Referral reason","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Referral reason","fieldKey":"referral_reason","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Referral reason","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''YES''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"listValueField","placeholder":"--select--","showContent":false,"staticOptions":"[{\"key\":\"-1\",\"value\":\"Other\"}]","listValueField":"referalReasonNonRch","requiredMessage":"Please select referral reason","errorMsgListKeys":[],"additionalStaticOptionsRequired":"true"},"Chronic Diseases":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"chronic_disease","hasError":false,"showCard":true,"fieldName":"Chronic Diseases","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Chronic Diseases","errorMsgListKeys":[]},"Unique Health ID":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"unique_health_id","hasError":false,"showCard":true,"fieldName":"Unique Health ID","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Member ID","errorMsgListKeys":[]},"Family Phone Number":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"family_phone_number","hasError":false,"showCard":true,"fieldName":"Family Phone Number","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"null","displayType":"text","showContent":false,"displayValue":"Family Phone Number","errorMsgListKeys":[]},"Health Infrastructue":{"label":"Health infrastructure","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Select health infrastructure","fieldKey":"referral_place","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Health Infrastructue","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''YES''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.is_referral_done\",\"queryCode\":null,\"expression\":null}]}}","optionsType":"variableList","placeholder":"-- select --","showContent":false,"variableList":"$utilityData$.healthInfraList","staticOptions":null,"requiredMessage":"Please search and select health infrastructure","errorMsgListKeys":[],"additionalStaticOptionsRequired":"false"},"User health facility":{"events":"null","ngModel":"$formData$.hivDetails","fieldKey":"referral_place","hasError":false,"showCard":true,"fieldName":"User health facility","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"CUSTOM\",\"operator\":null,\"value1\":null,\"value2\":null,\"fieldName\":null,\"queryCode\":null,\"expression\":\"$utilityData$.userHealthInfra?.health_infrastrucutre_id !== null\"}]}}","displayType":"text","showContent":false,"displayValue":"You will be referred to following health facility","errorMsgListKeys":[]},"Other referral reason":{"label":"Other referral reason","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Other referral reason","fieldKey":"other_referral_reason","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Other referral reason","fieldType":"SHORT_TEXT","maxLength":"100","minLength":"1","disability":"null","hasPattern":"false","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"FIELD\",\"operator\":\"EQWithType\",\"value1\":\"''-1''\",\"value2\":null,\"fieldName\":\"$formData$.hivDetails.referral_reason\",\"queryCode\":null,\"expression\":null}]}}","placeholder":"Other referral reason","showContent":false,"requiredMessage":"Please enter other referral reason","errorMsgListKeys":[]},"Is referral required ?":{"label":"Is referral required ?","events":"null","ngModel":"$formData$.hivDetails","tooltip":"Is referral required ?","fieldKey":"is_referral_done","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Is referral required ?","fieldType":"DROPDOWN","disability":"null","isDisabled":"false","isMultiple":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"-- Select Is referral required --","showContent":false,"staticOptions":"[{\"key\":\"YES\",\"value\":\"Yes\"},{\"key\":\"NO\",\"value\":\"No\"}]","requiredMessage":"Select is referral required","errorMsgListKeys":[],"additionalStaticOptionsRequired":"false"},"Last method of contraception":{"events":"null","ngModel":"$infoData$.memberDetails","fieldKey":"last_method_of_contraception","hasError":false,"showCard":true,"fieldName":"Last method of contraception","fieldType":"INFORMATION_DISPLAY","disability":"null","requirable":"null","visibility":"{\"conditions\":{\"rule\":\"AND\",\"options\":[{\"type\":\"VARIABLE\",\"operator\":\"GTE\",\"value1\":\"9\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null},{\"type\":\"VARIABLE\",\"operator\":\"LTE\",\"value1\":\"110\",\"value2\":null,\"fieldName\":\"$utilityData$.ageInYears\",\"queryCode\":null,\"expression\":null}]}}","displayType":"text","showContent":false,"displayValue":"Last method of contraception","errorMsgListKeys":[]},"Are you on ART (Anti-Retroviral Therapy) ?":{"label":"ART status?","events":"null","ngModel":"$formData$.hivDetails","tooltip":"ART status","fieldKey":"is_art_done","hasError":false,"isHidden":"false","showCard":true,"fieldName":"Are you on ART (Anti-Retroviral Therapy) ?","fieldType":"RADIO","isBoolean":"true","disability":"null","isDisabled":"false","isRequired":"true","requirable":"null","visibility":"null","optionsType":"staticOptions","placeholder":"ART done?","showContent":false,"staticOptions":"[{\"key\":\"true\",\"value\":\"Yes\"},{\"key\":\"false\",\"value\":\"No\"}]","requiredMessage":"Please select either yes or no","errorMsgListKeys":[]}}}',
	'DRAFT',
	97104,
	now(),
	97104,
	now(),
	'[{"title":"$formData$","isArray":false,"nodes":[{"title":"hivDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:1116","path":"$formData$.hivDetails","backendConfigPath":"$formData$.hivDetails"}],"path":"$formData$","backendConfigPath":"$formData$","$$hashKey":"object:2774"},{"title":"$infoData$","isArray":false,"nodes":[{"title":"memberDetails","nodes":[],"indexAlias":null,"$$hashKey":"object:2790","path":"$infoData$.memberDetails","backendConfigPath":"$infoData$.memberDetails"}],"path":"$infoData$","backendConfigPath":"$infoData$","$$hashKey":"object:2775"}]',
	null,
	'{"formVariables":[{"value":"ageInYears","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setAgeInYears","setterMethodCode":"(function setAgeInYears() {\n\n\tlet ageParts = $infoData$.memberDetails.age.split('' '');\n    let years = isNaN(parseInt(ageParts[0])) ? 0 : parseInt(ageParts[0]);\n    $utilityData$.ageInYears = years;\n    console.log($utilityData$.ageInYears)\n\t\n});"},{"value":"minLmpDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinLmpDate","setterMethodCode":"(function setMinLmpDate() {\n\n$utilityData$.minLmpDate = $infoData$.memberDetails.is_pregnant ? moment().subtract(9, ''months'') : moment().subtract(35, ''days'');\nconsole.log($infoData$.memberDetails.gender === ''F'')\n});"},{"value":"minServiceDate","type":"DATE","bindTo":"$utilityData$","setter":true,"setterMethodName":"setMinServiceDate","setterMethodCode":"(function setMinServiceDate() {\n\n\t$utilityData$.minServiceDate = $formData$.hivDetails.service_date ? moment($formData$.hivDetails.service_date) : moment().subtract(9, ''months'');\n\t\n});"},{"value":"userHealthInfra","type":"NUMBER","bindTo":"$utilityData$","setter":true,"setterMethodName":"setUserHealthInfra","setterMethodCode":"(function setUserHealthInfra() {\n\n\t/**\n\t* Setter method for $utilityData$.userHealthInfra (NUMBER)\n\t* Please see example below on how to set the value\n\t* $utilityData$.userHealthInfra = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"},{"value":"healthInfraList","type":"ARRAY","bindTo":"$utilityData$","setter":true,"setterMethodName":"setHealthInfraList","setterMethodCode":"(function setHealthInfraList() {\n\n\t/**\n\t* Setter method for $utilityData$.healthInfraList (ARRAY)\n\t* Please see example below on how to set the value\n\t* $utilityData$.healthInfraList = xxx;\n\t* You can use the available parameters\n\t*/\n\t\n});"}],"formMethods":[],"formQueries":[{"value":"Get Member Details","queryCode":"get_member_details","params":"member_id","paramConfig":"{\"member_id\":\"$stateParams$.id\"}","query":"select im.unique_health_id,concat_ws('' '', im.first_name,im.middle_name,im.last_name) as member_name,im.dob,im.gender,lfvd.value,im.religion,im.nrc_number,cast(age(current_date, im.dob) as text) as age,im.lmp,im.last_method_of_contraception,cast(im.additional_info as json)->> ''hivTest'' as hiv_status,\nim.chronic_disease,concat_ws('' '',imf.house_number,imf.address1, imf.address2) as family_address,im.mobile_number as family_phone_number from imt_member im inner join listvalue_field_value_detail lfvd on im.marital_status=lfvd.id inner join imt_family imf on im.family_id=imf.family_id where im.id=#member_id#;","response":"$infoData$.memberDetails","isResultArray":null,"successMessage":null,"failureMessage":"Member details not found","isResponseMandatory":true,"isField":null,"isPagination":false},{"value":"Get User Health Infra","queryCode":"get_user_health_infra","params":"userID","paramConfig":"{\"userID\":\"$loggedInUserId$\"}","query":"select health_infrastrucutre_id from user_health_infrastructure where user_id = #userID# and is_default = true;","response":"$utilityData$.userHealthInfra","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":null,"isPagination":false},{"value":"Get health infra","queryCode":"get_health_infra","params":"","paramConfig":"{}","query":"select  h.name , h.id,h.type as type from health_infrastructure_details h;","response":"$utilityData$.healthInfraList","isResultArray":true,"successMessage":null,"failureMessage":null,"isResponseMandatory":null,"isField":true,"isPagination":false,"dropdownKey":"id","dropdownValue":"name","toVariable":true},{"value":"Get hiv member details","queryCode":"get_hiv_mem_details","params":"memberId","paramConfig":"{\"memberId\":\"$stateParams$.id\"}","query":"select \n    id,\n    service_date,\n    is_art_done, \n    cast(referral_place as integer) as referral_place,\n    cast(referral_for as integer) as referral_reason,\n    referral_reason as other_referral_reason,\n    is_referral_done \n    from rch_preg_hiv_positive_master where\nmember_id=#memberId#;","response":"$formData$.hivDetails","isResultArray":null,"successMessage":null,"failureMessage":null,"isResponseMandatory":true,"isField":null,"isPagination":false}]}',
	'[{"type":"FORM_QUERY","value":"Get Member Details","continueIfFail":false},{"type":"FORM_QUERY","value":"Get hiv member details"},{"type":"FORM_VARIABLE_SETTER","value":"ageInYears","continueIfFail":true},{"type":"FORM_VARIABLE_SETTER","value":"minLmpDate","continueIfFail":true},{"type":"FORM_QUERY","value":"Get User Health Infra"},{"type":"FORM_QUERY","value":"Get health infra"}]',
	'[{"queryCode":"update_hiv_details","hasLoop":null,"queryPath":"$formData$.hivDetails","subQueries":[],"params":[{"key":"service_date","type":"FIELD","valueKey":"service_date"},{"key":"is_referral_done","type":"FIELD","valueKey":"is_referral_done"},{"key":"is_art_done","type":"FIELD","valueKey":"is_art_done"},{"key":"referral_place","type":"FIELD","valueKey":"referral_place"},{"key":"referral_reason","type":"FIELD","valueKey":"referral_reason"},{"key":"other_referral_reason","type":"FIELD","valueKey":"other_referral_reason"},{"key":"hiv_details_id","type":"META_DATA","valueKey":"$formData$.hivDetails.id"}],"isEventResource":null,"$$hashKey":"object:5584","queryName":"Update HIV members","query":"with updated_data as (\n    update rch_preg_hiv_positive_master\n    set service_date = #service_date#,\n    is_referral_done = #is_referral_done#,\n    is_art_done = #is_art_done#,\n    referral_place = #referral_place#,\n    modified_by = #loggedInUserId#,\n    referral_for=#referral_reason#,\n    referral_reason=  #other_referral_reason#,\n    modified_on = now()\n    where id=#hiv_details_id#\n    returning rch_preg_hiv_positive_master.id\n) select id from updated_data;"}]'
ON CONFLICT (form_master_uuid, "version")
DO UPDATE
SET
	form_master_uuid=EXCLUDED.form_master_uuid,
	template_config=EXCLUDED.template_config, 
	field_config=EXCLUDED.field_config, 
	"version"=EXCLUDED."version", 
	created_by=EXCLUDED.created_by,
	created_on=EXCLUDED.created_on,
	modified_by=EXCLUDED.modified_by,
	modified_on=EXCLUDED.modified_on,
	form_object=EXCLUDED.form_object,
	template_css=EXCLUDED.template_css,
	form_vm=EXCLUDED.form_vm,
	execution_sequence=EXCLUDED.execution_sequence,
	query_config=EXCLUDED.query_config;